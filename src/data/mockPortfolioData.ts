import { Site, Domain, Region, GlobalSummary, DomainSummary, RegionSummary } from '@/types/portfolio';
import type { SmallSiteProgramSettings } from '@/types/portfolio';

export type { SmallSiteProgramSettings };

export const defaultSettings: SmallSiteProgramSettings = {
  sqmThreshold: 50,
  budgetThreshold: 6000000,
  attendanceThreshold: 20,
  consecutiveMonthsThreshold: 3,
};

export const mockSites: Site[] = [
  // NA Region
  {
    id: 'NA-001',
    siteName: 'Herndon HQ',
    address: '1700 Tysons Blvd',
    country: 'USA',
    region: 'NA',
    siteType: 'Amdocs Site',
    status: 'Active',
    sqm: 5200,
    adminOwnerName: 'John Smith',
    adminOwnerEmail: 'john.smith@company.com',
    headcount: 450,
    workstations: 400,
    attendancePercent: 15,
    occupancyPercent: 35,
    businessUnit: 'North America Operations',
    utilizationRate: 28,
    realEstateAmount: 4200000,
    facilityManagementAmount: 890000,
    mealsAmount: 320000,
    transportationAmount: 180000,
    depreciationAmount: 450000,
    ehsCost: 75000,
    totalCost: 6115000,
    costPerEmployee: 13589,
    fy25Actual: 5800000,
    fy26Projection: 6300000,
    potentialSavings: 1200000,
    isREFM: true,
    isTIR: true,
    isEHS: true,
    isPhysicalSecurity: true,
    isOther: false,
    itNetworkStatus: 'Operational',
    criticalInfrastructureFlag: true,
    uptimePercent: 99.2,
    securityLevel: 'High',
    ehsComplianceStatus: 'Compliant',
    isSmallSiteCandidate: false,
    programStatus: 'Not Evaluated',
    programDecision: 'Pending',
    isNegativeCostAnomaly: false,
    isHighCost: true,
    isLowUtilization: true,
  },
  {
    id: 'NA-002',
    siteName: 'Dallas Office',
    address: '2001 Ross Ave',
    country: 'USA',
    region: 'NA',
    siteType: 'FSO',
    status: 'Under Review',
    sqm: 45,
    adminOwnerName: 'Sarah Johnson',
    adminOwnerEmail: 'sarah.johnson@company.com',
    headcount: 12,
    workstations: 15,
    attendancePercent: 18,
    occupancyPercent: 22,
    businessUnit: 'Sales',
    utilizationRate: 15,
    realEstateAmount: 180000,
    facilityManagementAmount: 45000,
    mealsAmount: 0,
    transportationAmount: 12000,
    depreciationAmount: 25000,
    ehsCost: 8000,
    totalCost: 270000,
    costPerEmployee: 22500,
    fy25Actual: 250000,
    fy26Projection: 280000,
    potentialSavings: 270000,
    isREFM: true,
    isTIR: false,
    isEHS: true,
    isPhysicalSecurity: true,
    isOther: false,
    securityLevel: 'Medium',
    ehsComplianceStatus: 'Review Pending',
    isSmallSiteCandidate: true,
    programStatus: 'Under Review',
    programDecision: 'Pending',
    regulatoryNotes: 'No legal entity address requirement',
    isNegativeCostAnomaly: false,
    isHighCost: false,
    isLowUtilization: true,
  },
  // ISR Region
  {
    id: 'ISR-001',
    siteName: 'Ra\'anana Campus',
    address: '8 Hapnina St',
    country: 'Israel',
    region: 'ISR',
    siteType: 'Amdocs Site',
    status: 'Active',
    sqm: 45000,
    adminOwnerName: 'David Cohen',
    adminOwnerEmail: 'david.cohen@company.com',
    headcount: 3200,
    workstations: 2800,
    attendancePercent: 72,
    occupancyPercent: 65,
    businessUnit: 'R&D',
    utilizationRate: 68,
    realEstateAmount: 28000000,
    facilityManagementAmount: 8500000,
    mealsAmount: 4200000,
    transportationAmount: 3800000,
    depreciationAmount: 2500000,
    ehsCost: 450000,
    totalCost: 47450000,
    costPerEmployee: 14828,
    fy25Actual: 45000000,
    fy26Projection: 48000000,
    potentialSavings: 0,
    isREFM: true,
    isTIR: true,
    isEHS: true,
    isPhysicalSecurity: true,
    isOther: false,
    itNetworkStatus: 'Operational',
    criticalInfrastructureFlag: true,
    uptimePercent: 99.8,
    disasterRecoveryPlanFlag: true,
    securityLevel: 'Critical',
    securityComplianceStatus: 'Compliant',
    ehsComplianceStatus: 'Compliant',
    isSmallSiteCandidate: false,
    programStatus: 'Not Evaluated',
    programDecision: 'Pending',
    isNegativeCostAnomaly: false,
    isHighCost: false,
    isLowUtilization: false,
  },
  {
    id: 'ISR-002',
    siteName: 'Tel Aviv Flex',
    address: '14 Abba Hillel',
    country: 'Israel',
    region: 'ISR',
    siteType: 'VO',
    status: 'Under Review',
    sqm: 35,
    adminOwnerName: 'Rachel Levi',
    adminOwnerEmail: 'rachel.levi@company.com',
    headcount: 8,
    workstations: 10,
    attendancePercent: 25,
    occupancyPercent: 30,
    businessUnit: 'Innovation Lab',
    utilizationRate: 22,
    realEstateAmount: 95000,
    facilityManagementAmount: 28000,
    mealsAmount: 0,
    transportationAmount: 8000,
    depreciationAmount: 12000,
    ehsCost: 5000,
    totalCost: 148000,
    costPerEmployee: 18500,
    fy25Actual: 140000,
    fy26Projection: 155000,
    potentialSavings: 148000,
    isREFM: true,
    isTIR: false,
    isEHS: true,
    isPhysicalSecurity: false,
    isOther: false,
    securityLevel: 'Low',
    ehsComplianceStatus: 'Compliant',
    isSmallSiteCandidate: true,
    programStatus: 'Check â€“ Legal',
    programDecision: 'Pending',
    legalNotes: 'Lease ends Q2 2025, no penalty for early termination',
    isNegativeCostAnomaly: false,
    isHighCost: false,
    isLowUtilization: true,
  },
  // IND Region
  {
    id: 'IND-001',
    siteName: 'Pune Tech Park',
    address: 'Hinjewadi Phase 2',
    country: 'India',
    region: 'IND',
    siteType: 'Amdocs Site',
    status: 'Active',
    sqm: 32000,
    adminOwnerName: 'Raj Patel',
    adminOwnerEmail: 'raj.patel@company.com',
    headcount: 4500,
    workstations: 4000,
    attendancePercent: 85,
    occupancyPercent: 78,
    businessUnit: 'Global Delivery',
    utilizationRate: 82,
    realEstateAmount: 18000000,
    facilityManagementAmount: 6200000,
    mealsAmount: 5500000,
    transportationAmount: 8200000,
    depreciationAmount: 2200000,
    ehsCost: 380000,
    totalCost: 40480000,
    costPerEmployee: 8996,
    fy25Actual: 38500000,
    fy26Projection: 42000000,
    potentialSavings: 0,
    isREFM: true,
    isTIR: true,
    isEHS: true,
    isPhysicalSecurity: true,
    isOther: false,
    itNetworkStatus: 'Operational',
    criticalInfrastructureFlag: true,
    uptimePercent: 99.5,
    disasterRecoveryPlanFlag: true,
    securityLevel: 'High',
    securityComplianceStatus: 'Compliant',
    ehsComplianceStatus: 'Compliant',
    isSmallSiteCandidate: false,
    programStatus: 'Not Evaluated',
    programDecision: 'Pending',
    isNegativeCostAnomaly: false,
    isHighCost: false,
    isLowUtilization: false,
  },
  {
    id: 'IND-002',
    siteName: 'Bangalore Satellite',
    address: 'Whitefield',
    country: 'India',
    region: 'IND',
    siteType: 'FSO',
    status: 'Active',
    sqm: 48,
    adminOwnerName: 'Priya Sharma',
    adminOwnerEmail: 'priya.sharma@company.com',
    headcount: 22,
    workstations: 25,
    attendancePercent: 65,
    occupancyPercent: 58,
    businessUnit: 'Customer Support',
    utilizationRate: 55,
    realEstateAmount: 120000,
    facilityManagementAmount: 35000,
    mealsAmount: 28000,
    transportationAmount: 42000,
    depreciationAmount: 18000,
    ehsCost: 6000,
    totalCost: 249000,
    costPerEmployee: 11318,
    fy25Actual: 235000,
    fy26Projection: 260000,
    potentialSavings: 0,
    isREFM: true,
    isTIR: false,
    isEHS: true,
    isPhysicalSecurity: true,
    isOther: false,
    securityLevel: 'Medium',
    ehsComplianceStatus: 'Compliant',
    isSmallSiteCandidate: true,
    programStatus: 'Retain & Optimize',
    programDecision: 'Retain & Optimize',
    decisionComments: 'High utilization despite small size - strategic location',
    isNegativeCostAnomaly: false,
    isHighCost: false,
    isLowUtilization: false,
  },
  // EMEA Region
  {
    id: 'EMEA-001',
    siteName: 'Dublin Office',
    address: 'Grand Canal Dock',
    country: 'Ireland',
    region: 'EMEA',
    siteType: 'Amdocs Site',
    status: 'Active',
    sqm: 2800,
    adminOwnerName: 'Patrick Murphy',
    adminOwnerEmail: 'patrick.murphy@company.com',
    headcount: 180,
    workstations: 200,
    attendancePercent: 45,
    occupancyPercent: 40,
    businessUnit: 'EMEA Sales',
    utilizationRate: 38,
    realEstateAmount: 3200000,
    facilityManagementAmount: 680000,
    mealsAmount: 220000,
    transportationAmount: 95000,
    depreciationAmount: 320000,
    ehsCost: 58000,
    totalCost: 4573000,
    costPerEmployee: 25406,
    fy25Actual: 4300000,
    fy26Projection: 4800000,
    potentialSavings: 800000,
    isREFM: true,
    isTIR: true,
    isEHS: true,
    isPhysicalSecurity: true,
    isOther: false,
    itNetworkStatus: 'Operational',
    uptimePercent: 99.1,
    securityLevel: 'High',
    ehsComplianceStatus: 'Compliant',
    isSmallSiteCandidate: false,
    programStatus: 'Not Evaluated',
    programDecision: 'Pending',
    isNegativeCostAnomaly: false,
    isHighCost: true,
    isLowUtilization: true,
  },
  {
    id: 'EMEA-002',
    siteName: 'London WeWork',
    address: 'Shoreditch',
    country: 'UK',
    region: 'EMEA',
    siteType: 'VO',
    status: 'Under Review',
    sqm: 28,
    adminOwnerName: 'Emma Wilson',
    adminOwnerEmail: 'emma.wilson@company.com',
    headcount: 5,
    workstations: 8,
    attendancePercent: 12,
    occupancyPercent: 18,
    businessUnit: 'Business Development',
    utilizationRate: 10,
    realEstateAmount: 85000,
    facilityManagementAmount: 0,
    mealsAmount: 0,
    transportationAmount: 8000,
    depreciationAmount: 0,
    ehsCost: 2000,
    totalCost: 95000,
    costPerEmployee: 19000,
    fy25Actual: 90000,
    fy26Projection: 100000,
    potentialSavings: 95000,
    isREFM: true,
    isTIR: false,
    isEHS: false,
    isPhysicalSecurity: false,
    isOther: false,
    securityLevel: 'Low',
    isSmallSiteCandidate: true,
    programStatus: 'Recommend Closure',
    programDecision: 'Recommend Closure',
    decisionComments: 'Very low utilization, flexible lease allows immediate exit',
    isNegativeCostAnomaly: false,
    isHighCost: false,
    isLowUtilization: true,
  },
  // APAC Region
  {
    id: 'APAC-001',
    siteName: 'Sydney Office',
    address: 'Barangaroo',
    country: 'Australia',
    region: 'APAC',
    siteType: 'Amdocs Site',
    status: 'Active',
    sqm: 1800,
    adminOwnerName: 'James Chen',
    adminOwnerEmail: 'james.chen@company.com',
    headcount: 120,
    workstations: 140,
    attendancePercent: 52,
    occupancyPercent: 48,
    businessUnit: 'APAC Operations',
    utilizationRate: 45,
    realEstateAmount: 2800000,
    facilityManagementAmount: 520000,
    mealsAmount: 180000,
    transportationAmount: 75000,
    depreciationAmount: 280000,
    ehsCost: 42000,
    totalCost: 3897000,
    costPerEmployee: 32475,
    fy25Actual: 3700000,
    fy26Projection: 4100000,
    potentialSavings: 600000,
    isREFM: true,
    isTIR: true,
    isEHS: true,
    isPhysicalSecurity: true,
    isOther: false,
    itNetworkStatus: 'Operational',
    uptimePercent: 99.3,
    securityLevel: 'High',
    ehsComplianceStatus: 'Compliant',
    isSmallSiteCandidate: false,
    programStatus: 'Not Evaluated',
    programDecision: 'Pending',
    isNegativeCostAnomaly: false,
    isHighCost: true,
    isLowUtilization: true,
  },
  // CALA Region
  {
    id: 'CALA-001',
    siteName: 'Mexico City Hub',
    address: 'Polanco',
    country: 'Mexico',
    region: 'CALA',
    siteType: 'Amdocs Site',
    status: 'Active',
    sqm: 2200,
    adminOwnerName: 'Carlos Rodriguez',
    adminOwnerEmail: 'carlos.rodriguez@company.com',
    headcount: 280,
    workstations: 300,
    attendancePercent: 68,
    occupancyPercent: 62,
    businessUnit: 'LATAM Operations',
    utilizationRate: 60,
    realEstateAmount: 1800000,
    facilityManagementAmount: 420000,
    mealsAmount: 320000,
    transportationAmount: 280000,
    depreciationAmount: 220000,
    ehsCost: 48000,
    totalCost: 3088000,
    costPerEmployee: 11029,
    fy25Actual: 2900000,
    fy26Projection: 3200000,
    potentialSavings: 0,
    isREFM: true,
    isTIR: true,
    isEHS: true,
    isPhysicalSecurity: true,
    isOther: false,
    itNetworkStatus: 'Operational',
    uptimePercent: 98.8,
    securityLevel: 'High',
    ehsComplianceStatus: 'Compliant',
    isSmallSiteCandidate: false,
    programStatus: 'Not Evaluated',
    programDecision: 'Pending',
    isNegativeCostAnomaly: false,
    isHighCost: false,
    isLowUtilization: false,
  },
];

export function calculateGlobalSummary(sites: Site[]): GlobalSummary {
  const totalBudget = sites.reduce((sum, site) => sum + site.totalCost, 0);
  const totalSites = sites.length;
  const avgOccupancy = sites.reduce((sum, site) => sum + site.occupancyPercent, 0) / totalSites;
  const avgAttendance = sites.reduce((sum, site) => sum + site.attendancePercent, 0) / totalSites;
  const smallSiteCandidates = sites.filter(site => site.isSmallSiteCandidate).length;

  const domains: Domain[] = ['REFM', 'TIR', 'Physical Security', 'EHS Facility', 'Others'];
  const regions: Region[] = ['NA', 'CALA', 'APAC', 'IND', 'ISR', 'EMEA'];

  const domainBreakdown: DomainSummary[] = domains.map(domain => {
    const domainSites = sites.filter(site => {
      if (domain === 'REFM') return site.isREFM;
      if (domain === 'TIR') return site.isTIR;
      if (domain === 'Physical Security') return site.isPhysicalSecurity;
      if (domain === 'EHS Facility') return site.isEHS;
      if (domain === 'Others') return site.isOther;
      return false;
    });
    return {
      domain,
      totalBudget: domainSites.reduce((sum, site) => sum + site.totalCost, 0),
      siteCount: domainSites.length,
      avgOccupancy: domainSites.length > 0 ? domainSites.reduce((sum, site) => sum + site.occupancyPercent, 0) / domainSites.length : 0,
      avgAttendance: domainSites.length > 0 ? domainSites.reduce((sum, site) => sum + site.attendancePercent, 0) / domainSites.length : 0,
      smallSiteCandidates: domainSites.filter(site => site.isSmallSiteCandidate).length,
    };
  });

  const regionBreakdown: RegionSummary[] = regions.map(region => {
    const regionSites = sites.filter(site => site.region === region);
    const regionDomains = new Set<Domain>();
    regionSites.forEach(site => {
      if (site.isREFM) regionDomains.add('REFM');
      if (site.isTIR) regionDomains.add('TIR');
      if (site.isPhysicalSecurity) regionDomains.add('Physical Security');
      if (site.isEHS) regionDomains.add('EHS Facility');
      if (site.isOther) regionDomains.add('Others');
    });
    return {
      region,
      totalBudget: regionSites.reduce((sum, site) => sum + site.totalCost, 0),
      siteCount: regionSites.length,
      avgOccupancy: regionSites.length > 0 ? regionSites.reduce((sum, site) => sum + site.occupancyPercent, 0) / regionSites.length : 0,
      avgAttendance: regionSites.length > 0 ? regionSites.reduce((sum, site) => sum + site.attendancePercent, 0) / regionSites.length : 0,
      smallSiteCandidates: regionSites.filter(site => site.isSmallSiteCandidate).length,
      domains: Array.from(regionDomains),
    };
  });

  return {
    totalBudget,
    totalSites,
    avgOccupancy,
    avgAttendance,
    smallSiteCandidates,
    domainBreakdown,
    regionBreakdown,
  };
}

export function getSitesByRegion(sites: Site[], region: Region): Site[] {
  return sites.filter(site => site.region === region);
}

export function getSitesByDomain(sites: Site[], domain: Domain): Site[] {
  return sites.filter(site => {
    if (domain === 'REFM') return site.isREFM;
    if (domain === 'TIR') return site.isTIR;
    if (domain === 'Physical Security') return site.isPhysicalSecurity;
    if (domain === 'EHS Facility') return site.isEHS;
    if (domain === 'Others') return site.isOther;
    return false;
  });
}
